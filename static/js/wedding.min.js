var Mustache=function(){function g(a){return(a+"").replace(/&(?!\w+;)|[<>"']/g,function(a){return f[a]||a})}var a=Object.prototype.toString;Array.isArray=Array.isArray||function(b){return a.call(b)=="[object Array]"};var b=String.prototype.trim,c;if(b)c=function(a){return a==null?"":b.call(a)};else{var d,e;/\S/.test("Â ")?(d=/^[\s\xA0]+/,e=/[\s\xA0]+$/):(d=/^\s+/,e=/\s+$/),c=function(a){return a==null?"":(a+"").replace(d,"").replace(e,"")}}var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},h={},i=function(){};return i.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(a,b,c,d){d||(this.context=b,this.buffer=[]);if(!this.includes("",a)){if(d)return a;this.send(a);return}a=this.render_pragmas(a);var e=this.render_section(a,b,c);e===!1&&(e=this.render_tags(a,b,c,d));if(d)return e;this.sendLines(e)},send:function(a){a!==""&&this.buffer.push(a)},sendLines:function(a){if(a){var b=a.split("\n");for(var c=0;c<b.length;c++)this.send(b[c])}},render_pragmas:function(a){if(!this.includes("%",a))return a;var b=this,c=this.getCachedRegex("render_pragmas",function(a,b){return RegExp(a+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+b,"g")});return a.replace(c,function(a,c,d){if(!b.pragmas_implemented[c])throw{message:"This implementation of mustache doesn't understand the '"+c+"' pragma"};b.pragmas[c]={};if(d){var e=d.split("=");b.pragmas[c][e[0]]=e[1]}return""})},render_partial:function(a,b,d){a=c(a);if(!d||d[a]===undefined)throw{message:"unknown_partial '"+a+"'"};return!b||typeof b[a]!="object"?this.render(d[a],b,d,!0):this.render(d[a],b[a],d,!0)},render_section:function(a,b,c){if(!this.includes("#",a)&&!this.includes("^",a))return!1;var d=this,e=this.getCachedRegex("render_section",function(a,b){return RegExp("^([\\s\\S]*?)"+a+"(\\^|\\#)\\s*(.+)\\s*"+b+"\n*([\\s\\S]*?)"+a+"\\/\\s*\\3\\s*"+b+"\\s*([\\s\\S]*)$","g")});return a.replace(e,function(a,e,f,g,h,i){var j=e?d.render_tags(e,b,c,!0):"",k=i?d.render(i,b,c,!0):"",l,m=d.find(g,b);return f==="^"?!m||Array.isArray(m)&&m.length===0?l=d.render(h,b,c,!0):l="":f==="#"&&(Array.isArray(m)?l=d.map(m,function(a){return d.render(h,d.create_context(a),c,!0)}).join(""):d.is_object(m)?l=d.render(h,d.create_context(m),c,!0):typeof m=="function"?l=m.call(b,h,function(a){return d.render(a,b,c,!0)}):m?l=d.render(h,b,c,!0):l=""),j+l+k})},render_tags:function(a,b,c,d){var e=this,f=function(){return e.getCachedRegex("render_tags",function(a,b){return RegExp(a+"(=|!|>|&|\\{|%)?([^#\\^]+?)\\1?"+b+"+","g")})},h=f(),i=function(a,d,i){switch(d){case"!":return"";case"=":return e.set_delimiters(i),h=f(),"";case">":return e.render_partial(i,b,c);case"{":case"&":return e.find(i,b);default:return g(e.find(i,b))}},j=a.split("\n");for(var k=0;k<j.length;k++)j[k]=j[k].replace(h,i,this),d||this.send(j[k]);if(d)return j.join("\n")},set_delimiters:function(a){var b=a.split(" ");this.otag=this.escape_regex(b[0]),this.ctag=this.escape_regex(b[1])},escape_regex:function(a){if(!arguments.callee.sRE){var b=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=RegExp("(\\"+b.join("|\\")+")","g")}return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){function d(a){return a===!1||a===0||a}a=c(a);var e;if(a.match(/([a-z_]+)\./ig)){var f=this.walk_context(a,b);d(f)&&(e=f)}else d(b[a])?e=b[a]:d(this.context[a])&&(e=this.context[a]);return typeof e=="function"?e.apply(b):e!==undefined?e:""},walk_context:function(a,b){var c=a.split("."),d=b[c[0]]!=undefined?b:this.context,e=d[c.shift()];while(e!=undefined&&c.length>0)d=e,e=e[c.shift()];return typeof e=="function"?e.apply(d):e},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},create_context:function(a){if(this.is_object(a))return a;var b=".";this.pragmas["IMPLICIT-ITERATOR"]&&(b=this.pragmas["IMPLICIT-ITERATOR"].iterator);var c={};return c[b]=a,c},is_object:function(a){return a&&typeof a=="object"},map:function(a,b){if(typeof a.map=="function")return a.map(b);var c=[],d=a.length;for(var e=0;e<d;e++)c.push(b(a[e]));return c},getCachedRegex:function(a,b){var c=h[this.otag];c||(c=h[this.otag]={});var d=c[this.ctag];d||(d=c[this.ctag]={});var e=d[a];return e||(e=d[a]=b(this.otag,this.ctag)),e}},{name:"mustache.js",version:"0.4.0-dev",to_html:function(a,b,c,d){var e=new i;d&&(e.send=d),e.render(a,b||{},c);if(!d)return e.buffer.join("\n")}}}();jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(a,b,c,d,e){return jQuery.easing[jQuery.easing.def](a,b,c,d,e)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b+c:d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b+c:-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){return b==0?c:b==e?c+d:(b/=e/2)<1?d/2*Math.pow(2,10*(b-1))+c:d/2*(-Math.pow(2,-10*--b)+2)+c},easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){return(b/=e/2)<1?-d/2*(Math.sqrt(1-b*b)-1)+c:d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g))+c},easeOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*b)*Math.sin((b*e-f)*2*Math.PI/g)+d+c},easeInOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e/2)==2)return c+d;g||(g=e*.3*1.5);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return b<1?-0.5*h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)+c:h*Math.pow(2,-10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)*.5+d+c},easeInBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*(b/=e)*b*((f+1)*b-f)+c},easeOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeInOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),(b/=e/2)<1?d/2*b*b*(((f*=1.525)+1)*b-f)+c:d/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+c},easeInBounce:function(a,b,c,d,e){return d-jQuery.easing.easeOutBounce(a,e-b,0,d,e)+c},easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?d*7.5625*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c},easeInOutBounce:function(a,b,c,d,e){return b<e/2?jQuery.easing.easeInBounce(a,b*2,0,d,e)*.5+c:jQuery.easing.easeOutBounce(a,b*2-e,0,d,e)*.5+d*.5+c}});(function(a){var b=a({});a.subscribe=function(){b.bind.apply(b,arguments)},a.unsubscribe=function(){b.unbind.apply(b,arguments)},a.publish=function(){b.trigger.apply(b,arguments)}})(jQuery);(function(a,b){"use strict";var c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.fn.imagesLoaded=function(d){function l(){var b=a(j),c=a(k);f&&(k.length?f.reject(h,b,c):f.resolve(h)),a.isFunction(d)&&d.call(e,h,b,c)}function m(b,d){if(b.src===c||a.inArray(b,i)!==-1)return;i.push(b),d?k.push(b):j.push(b),a.data(b,"imagesLoaded",{isBroken:d,src:b.src}),g&&f.notifyWith(a(b),[d,h,a(j),a(k)]),h.length===i.length&&(setTimeout(l),h.unbind(".imagesLoaded"))}var e=this,f=a.isFunction(a.Deferred)?a.Deferred():0,g=a.isFunction(f.notify),h=e.find("img").add(e.filter("img")),i=[],j=[],k=[];return h.length?h.bind("load.imagesLoaded error.imagesLoaded",function(a){m(a.target,a.type==="error")}).each(function(d,e){var f=e.src,g=a.data(e,"imagesLoaded");if(g&&g.src===f){m(e,g.isBroken);return}if(e.complete&&e.naturalWidth!==b){m(e,e.naturalWidth===0||e.naturalHeight===0);return}if(e.readyState||e.complete)e.src=c,e.src=f}):l(),f?f.promise(e):e}})(jQuery);(function(a){a.fn.maskImage=function(b,c){var d;return this.each(function(){if(!a(this).is("img")||!b.is("img"))throw"Please supply only <img> elements to the maskImage function";var e=document.createElement("canvas"),f=e.getContext("2d"),g=a(this).outerWidth(),h=a(this).outerHeight();if(!e.getContext||!f)return;e.width=g,e.height=h,g>0&&h>0&&(f.save(),f.globalCompositeOperation="copy",f.drawImage(b.get(0),0,0),f.globalCompositeOperation="source-in",f.drawImage(this,0,0),c&&(f.globalCompositeOperation="destination-over",f.drawImage(c.get(0),0,0)),f.restore(),a(e).prependTo(a(this).parent())),d=d||a(e),d=d.add(a(e))}),d}})(jQuery);(function(a){a.fn.reflectImage=function(b,c){var d;return this.each(function(){if(!a(this).is("img"))throw"Please only use <img> elements with the reflectImage function";var e=document.createElement("canvas"),f=e.getContext("2d"),g=a(this).outerWidth(),h=c||a(this).outerHeight(),i=b||h;if(g>0&&h>0){e.width=g,e.height=i,f.globalCompositeOperation="copy";var j=f.createLinearGradient(0,0,0,i);j.addColorStop(0,"rgba(0,0,0,1)"),j.addColorStop(1,"rgba(0,0,0,0)"),f.fillStyle=j,f.translate(0,0),f.rect(0,0,g,h),f.fill(),f.globalCompositeOperation="source-in",f.translate(0,h),f.scale(1,-1),f.drawImage(this,0,0,g,h),a(this).after(a(e))}d=d||a(e),d=d.add(a(e))}),d}})(jQuery);(function(a){a.fn.cloneCanvas=function(){var b;return this.each(function(){if(!a(this).is("canvas"))throw"Please supply only <canvas> elements to the cloneCanvas function";var c=document.createElement("canvas"),d=c.getContext("2d"),e=a(this).outerWidth(),f=a(this).outerHeight();c.width=e,c.height=f,d.drawImage(this,0,0),b=b||a(c),b=b.add(a(c))}),b}})(jQuery);(function(){if(!Modernizr||typeof Modernizr.prefixed!="function")throw"Load custom Modernizr.js with 'prefixed' feature in <head> of document.";Modernizr.transitionEnd=function(){if(Modernizr.csstransitions){var a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionEnd"};return a[Modernizr.prefixed("transition")]}return}(),Modernizr.addTest("h264",function(){if(!document.createElement("video").canPlayType)return!1;var a=document.createElement("video");return a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}),Modernizr.addTest("grayscale",function(){return typeof document.body.style.filter=="undefined"&&typeof document.body.style.webkitFilter=="undefined"?!1:!0}),Modernizr.addTest("cssmask",Modernizr.testAllProps("mask-repeat"));function a(a){var b,c,d,e=document,f=e.documentElement,g=f.getElementsByTagName("head")[0],h=e.implementation||{hasFeature:function(){return!1}},c=e.createElement("style");return c.type="text/css",(g||f).insertBefore(c,(g||f).firstChild),d=c.sheet||c.styleSheet,!d||!a?!1:(b=h.hasFeature("CSS2","")?function(a){try{d.insertRule(a+"{ }",0),d.deleteRule(d.cssRules.length-1)}catch(b){return!1}return!0}:function(a){return d.cssText=a+" { }",d.cssText.length!==0&&!/unknown/i.test(d.cssText)&&d.cssText.indexOf(a)===0},b(a))}Modernizr.addTest("nthchild",function(){return a(":nth-child(1)")})})();(function(a){a.fn.cube=function(b,c){var d=function(b){var c='<figure class="cube">',d=0;for(d=b.length-1;d>=0;d--)c+="<div></div>";return c+="</figure>",a(c)},e=function(b,d){var e,f=c.width,g=c.height,h=c.depth,i=a(b),j;switch(d){case"front":e="translateZ("+h/2+"px)",i.width(f),i.height(g),j=i;break;case"top":e="rotateX(90deg) translateZ("+h/2+"px)",i.width(f),i.height(h);break;case"bottom":e="rotateX(-90deg) translateZ("+(g-h/2)+"px)",i.width(f),i.height(h);break;case"back":e="rotateX(180deg) translateZ("+h/2+"px)",i.width(f),i.height(g);break;case"right":e="rotateY(90deg) translateZ("+(f-h/2)+"px)",i.width(h),i.height(g);break;case"left":e="rotateY(-90deg) translateZ("+h/2+"px)",i.width(h),i.height(g)}return b.style[Modernizr.prefixed("transform")]=e,j};return function(){var f;return this.each(function(){var g=a(this).hasClass("cube")?a(this):d(b),h=g.find(" > div"),i,j=0;c=c||{},c.width=c.width||a(this).outerWidth(!0),c.height=c.height||a(this).outerHeight(!0),c.depth=c.depth||c.height;for(j=b.length-1;j>=0;j--)i=e(h[j],b[j])||i;g.data("depth",-c.depth/2),f=f||g,f=f.add(g),a(this).hasClass("cube")||(g.get(0).style[Modernizr.prefixed("transform")]="translateZ("+ -c.depth/2+"px)",a(this).replaceWith(g),i.html(a(this)))}),f}.call(this)}})(jQuery);(function(){var a=!1,b=/xyz/.test(function(){var a})?/\bsup\b/:/.*/;this.Class=function(){},Class.extend=function c(d,e){function m(b){this.vars=$.extend(!0,{},this.vars,b),!a&&this.init&&this.init.apply(this,arguments)}var f=this.prototype,g=this,h,i,j,k,l;a=!0,h=new g,a=!1;for(i in d)d.hasOwnProperty(i)&&(l=d[i],h[i]=typeof l=="function"&&typeof f[i]=="function"&&b.test(l)?function(a,b){return function(){return j=this.sup,this.sup=f[a],k=b.apply(this,arguments),this.sup=j,k}}(i,l):l);return h.vars=$.extend(!0,{},this.prototype.vars,h.vars),m.prototype=h,m.constructor=m,m.extend=c,typeof e=="object"&&$.extend(m,e),m}})();var red=window.red||{};$.extend(!0,red,{Class:Class.extend({preventDefault:function(a){a.preventDefault()},setTimeout:function(a,b){return window.setTimeout($.proxy(a,this),b)}})});var red=red||{};red.module=red.module||{},red.Module=function(){return red.Class.extend({vars:{events:{}},bind:function(a,b){this.vars.events["on"+a]=this.vars.events["on"+a]||[],this.vars.events["on"+a].push(b)},unbind:function(a,b){var c=this.vars.events["on"+a],d,e;if(c)for(d=0,e=c.length;d<e;d++)if(!b||c[d]===b)c[d]=null},trigger:function(a,b){if(!this.vars.events)return;var c=this.vars.events["on"+a],d,e,f;if(c&&c.length){Object.prototype.toString.call(b)!=="[object Array]"&&(b=[b]),b[0].type=b[0].type||a;for(d=0,e=c.length;d<e;d++)f=c[d],f&&f.apply(this,b||[{type:a}])}}})}.call(red);var red=red||{};red.module=red.module||{},red.module.social=red.module.social||{},red.module.social.Facebook=function(){var a={POST:"social/facebook/post",RENDER:"social/render"};return red.Module.extend({vars:{},_media_url:null,_app_id:null,init:function(){this.loadJSDK(),$('[data-custom-social="facebook"]').live("click",$.proxy(this.customFacebookPost,this)),$.subscribe(a.POST,$.proxy(this.customFacebookPost,this)),$.subscribe(a.RENDER,$.proxy(this.render,this))},onShare:function(a){},onAddComment:function(a){},onSesionChange:function(a){},onStatusChange:function(a){},onLogin:function(a){},onLike:function(a){var b="on-like-"+(a.indexOf("seed")>0?"profile":"other");$.publish("track",[{type:"event",category:"facebook",action:b,label:a}])},onRender:function(){},customFacebookPost:function(a,b){var c=$(a.currentTarget),d=b||c.data(),e=this.getPublishObj(d);return FB.ui(e),$.publish("track",[{type:"event",category:"facebook",action:"on-post",label:d.origin}]),d},getPublishObj:function(a){return{method:a.method||"stream.publish",origin:a.origin||$('meta[property="og:url"]').attr("content"),attachment:{name:a.attachmentName||$('meta[property="og:title"]').attr("content"),caption:a.attachmentCaption||$('meta[property="og:description"]').attr("content"),description:a.attachmentDescription||"",media:[{type:a.attachmentMediaType||"image",src:a.attachmentMediaSrc||$('meta[property="og:image"]').attr("content"),href:a.attachmentMediaHref||$('meta[property="og:url"]').attr("content")}]},action_links:[{text:a.attachmentActionText||"Click Here",href:a.attachmentActionHref||$('meta[property="og:url"]').attr("content")}]}},onFBInit:function(){FB.Event.unsubscribe("xfbml.render",this.onFBInit)},fbAsyncInit:function(){FB.Event.subscribe("comments.add",$.proxy(this.onAddComment,this)),FB.Event.subscribe("auth.sessionChange",$.proxy(this.onSesionChange,this)),FB.Event.subscribe("auth.statusChange",$.proxy(this.onStatusChange,this)),FB.Event.subscribe("auth.login",$.proxy(this.onLogin,this)),FB.Event.subscribe("edge.create",$.proxy(this.onLike,this)),FB.Event.subscribe("xfbml.render",$.proxy(this.onRender,this)),FB.Event.subscribe("xfbml.render",$.proxy(this.onFBInit,this)),FB.init({appId:this._app_id,channelUrl:this._media_url+"/js/red/modules/social/facebook-channel.html",status:!0,cookie:!0,oauth:!0,xfbml:!0})},render:function(){FB.XFBML.parse()},loadJSDK:function(){$("#fb-root").length||$("body .scripts").append($('<div id="fb-root">')),this._media_url=$('link[rel="media-url"]').attr("href"),this._app_id=$('meta[property="fb:app_id"]').attr("content");if(!this._media_url)throw'red/modules/social/Facebook.js requires a rel="media-url"';if(!this._app_id)throw"red/modules/social/Facebook.js requires meta og:app_id.";window.fbAsyncInit=$.proxy(this.fbAsyncInit,this),function(a){var b,c="facebook-jssdk";if(a.getElementById(c))return;b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/en_US/all.js",a.getElementsByTagName("head")[0].appendChild(b)}(document)},destroy:function(){$('[data-custom-social="facebook"]').die("click",$.proxy(this.customFacebookPost,this)),$.unsubscribe(a.POST,$.proxy(this.customFacebookPost,this)),$.unsubscribe(a.RENDER,$.proxy(this.render,this))}},a)}.call(red.module.social);var red=red||{};red.module=red.module||{},red.module.social=red.module.social||{},red.module.social.Twitter=function(){var a={POST:"custom-twitter-post",RENDER:"social/render"};return red.Module.extend({_twitter_url:"https://twitter.com/share?",init:function(){this.loadJSDK(),$('[data-custom-social="twitter"]').live("click",$.proxy(this.customTweet,this)),$.subscribe(a.POST,$.proxy(this.customTweet,this)),$.subscribe(a.RENDER,$.proxy(this.render,this))},onTwitterInit:function(){window.twttr&&(window.twttr.events.bind("tweet",$.proxy(this.onTweet,this)),window.twttr.events.bind("follow",$.proxy(this.onFollow,this)))},querystring:function(a){var b=/\+/g,c=/([^&=]+)=?([^&]*)/g,d=function(a){return decodeURIComponent(a.replace(b," "))},e=a||window.location.search.substring(1),f={},g=c.exec(e);while(g)f[d(g[1])]=d(g[2]),g=c.exec(e);return f},onTweet:function(a,b){var c=a.currentTarget?$(a.currentTarget):$(a.target),d=b||c.data()||{},e=b.url||this.querystring(c.attr("src")).url;return $.publish("track",[{type:"event",category:"twitter",action:"on-tweet",label:e||window.location.href}]),d},onFollow:function(a,b){var c=$(a.currentTarget),d=b||c.data();return $.publish("track",[{type:"event",category:"twitter",action:"on-follow",label:d.url}]),d},customTweet:function(a,b){var c=a?$(a.currentTarget):null,d=b||c.data(),e=this._twitter_url,f;d.url=d.url,d.text=d.text||document.title;for(f in d)typeof d[f]=="string"&&(e+="&"+f+"="+encodeURIComponent(d[f]));window.open(e,"sharer","toolbar=0,status=0,scrollbars=1,width=575,height=338"),this.onTweet(a,b)},render:function(){$.ajax({url:"//platform.twitter.com/widgets.js",dataType:"script",cache:!0})},loadJSDK:function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="//platform.twitter.com/widgets.js",document.getElementsByTagName("head")[0].appendChild(a),$(a).load($.proxy(function(){this.onTwitterInit()},this))},destroy:function(){$('[data-custom-social="twitter"]').die("click",$.proxy(this.customTweet,this)),$.unsubscribe(a.POST,$.proxy(this.customTweet,this)),$.unsubscribe(a.RENDER,$.proxy(this.render,this))}},a)}.call(red.module.social);var red=red||{};red.module=red.module||{},red.module.tracking=red.module.tracking||{};var _gaq=_gaq||[];(function(){red.module.tracking.GA=function(){return red.Module.extend({vars:{debug:!0,property_id:"",domain:""},init:function(){this.loadJSDK(),$.subscribe("track",$.proxy(this.track,this))},log:function(){if(this.vars.debug)try{console.log(arguments)}catch(a){}},track:function(a,b){var c=$(a.currentTarget),d=b||c.data();d.type=d.type||"event",this.log("ga track",d.type,d);switch(d.type){case"event":_gaq.push(["_trackEvent",d.category,d.action,d.label,d.value]);break;case"social":console.log("Tracking: GA social (not hooked up yet)::",d);break;default:case"page":_gaq.push(["_trackPageview",d.url||window.location.hash])}},loadJSDK:function(){var a=window._gaq=window._gaq||[];this.vars.property_id=this.vars.property_id||$('meta[property="ga:property_id"]').attr("content"),this.vars.domain=this.vars.domain||$('meta[property="ga:domain"]').attr("content");if(!this.vars.property_id)return;if(!this.vars.domain)throw'tracking:GA missing DOMAIN  <meta property="ga:domain" content="xxxxx.com"/>';this.log("ga.tracking:: "+this.vars.property_id),a.push(["_setAccount",this.vars.property_id]),a.push(["_setDomainName",this.vars.domain]),a.push(["_setAllowLinker",!0]),a.push(["_trackPageview"]),a.push(["_trackPageLoadTime"]),Modernizr.load({load:("https:"===location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js"})},destroy:function(){$.unsubscribe("track",$.proxy(this.track,this)),this.vars=null}})}.call(red.module.tracking)})();var red=red||{},wedding=wedding||{};red.Site=$.extend(!0,wedding,red,function(){return{models:{},init:function(){$(document).ready(this.onReady.call(this))},setMediaURL:function(){red.SYS=red.SYS||{},red.SYS.MEDIA_URL=$("link[rel='media-url']").attr("href"),red.SYS.SITE_URL=$("link[rel='site-url']").attr("href")},createModel:function(a,b){var c=this.page,d=a&&typeof c[a]=="function"?c[a]:c;return this.models[a||"page"]=new d(b)},getModel:function(a){return this.models[a]},getModels:function(){return this.models},onReady:function(){var a=$("body"),b=a.data("pageClass");this.setMediaURL(),this.models.GATracking=new this.module.tracking.GA,this.models.Shell=new this.module.Shell,this.models.Home=new this.page.Home,this.models.Story=new this.page.Story,this.models.Guests=new this.page.Guests,this.models.RSVP=new this.page.RSVP,this.models.Facebook=new this.module.social.Facebook,this.models.Twitter=new this.module.social.Twitter}}}());var red=red||{},wedding=wedding||{};wedding.module=wedding.module||{},wedding.Module=function(){return red.Module.extend({vars:{delays:[],delay_timer:null,resize_timer:null,resize_throttle:100},init:function(){$(window).bind("resize",$.proxy(this.onDelayedResize,this))},onResize:function(){},onDelayedResize:function(a){a?(this.vars.resize_timer&&window.clearTimeout(this.vars.resize_timer),this.vars.resize_timer=window.setTimeout($.proxy(this.onDelayedResize,this),this.vars.resize_throttle)):this.onResize()},destroy:function(){$(window).unbind("resize",$.proxy(this.onDelayedResize,this))}})}.call(wedding);var red=red||{},wedding=wedding||{};wedding.module=wedding.module||{},wedding.module.Shell=function(){var a=$("header nav"),b=a.find("a"),c=$("html"),d=$("body"),e;return wedding.Module.extend({init:function(){d.on("click","a[data-section]",$.proxy(this.onClickNav,this)),$(window).bind("scroll",$.proxy(this.onScroll,this)),this.updateNavSelection(!0)},getScrollPos:function(){return $("html").scrollTop()||$("body").scrollTop()},onScroll:function(a){this.vars.timeout&&window.clearTimeout(this.vars.timeout),this.vars.timeout=this.setTimeout(this.updateNavSelection,200)},updateNavSelection:function(a,c){var d=this.getScrollPos();e||(e=[],$("section.page").each(function(){var a=$(this).offset().top,b=$(this).height()+a-191;e.push({top:a,bottom:b,id:$(this).attr("id")})}));if(!c){for(i=e.length-1;i>=0;i--)if(d<=e[i].bottom&&d>=e[i].top){c=e[i].id;break}c||(c=$("section.page").attr("id"))}b.parent().removeClass("selected"),b.filter('[data-section="'+c+'"]').parent().addClass("selected"),!a,this.vars.sectionId!==c&&$.publish("track",[{type:"page",url:c}]),this.vars.sectionId=c},scrollToSection:function(a){var b=$("section#"+a),e=b.offset().top+100;e=a==="welcome"?0:e,c.add(d).animate({scrollTop:e},540,"easeInOutExpo")},onClickNav:function(a){var b=$(a.currentTarget),c=b.data("section"),d=c?$("section#"+c):null,e;if(c&&d)a.preventDefault(),this.updateNavSelection(!1,c),this.scrollToSection(c);else throw"That section does not exist";return!1}})}.call(wedding);var wedding=wedding||{};wedding.module=wedding.module||{},wedding.module.tracking=wedding.module.tracking||{},function(){wedding.module.tracking.GA=function(){return wedding.module.tracking.GA.extend({vars:{debug:!1},init:function(a){this.sup.call(this,a),$("a[href]").live("click",$.proxy(this.autoLinkTracking,this))},getPath:function(){var a=$("body").data("pageClass")||window.location.pathname;return a},autoLinkTracking:function(a){var b=$(a.currentTarget),c=b.attr("href"),d=b.data("section")?"link-interior":"link-exterior";$.publish("track",[{type:"event",category:d,action:"from: "+this.getPath(),label:"to: "+c}])},destroy:function(){$("[data-tracking]").die("click",$.proxy(this.autoLinkTracking,this)),this.sup.call(this)}})}.call(wedding.module.tracking)}();var wedding=wedding||{};wedding.page=wedding.page||{},wedding.Page=function(){return red.Class.extend({vars:{},init:function(){}})}.call(wedding);var wedding=wedding||{};wedding.page=wedding.page||{},wedding.page.Home=function(){var a=$("#welcome"),b=a.find(".hero");return wedding.Page.extend({vars:{},init:function(){Modernizr.cssmask?b.clone().appendTo($("#rsvp aside")):this.simulateImageMask(),$.subscribe(wedding.module.social.Facebook.HANDLE_LOGIN,$.proxy(this.onLogin,this)),$.subscribe(wedding.module.social.Facebook.HANDLE_LOGOUT,$.proxy(this.onLogout,this)),$.publish(wedding.module.social.Facebook.GET_STATUS)},onLogin:function(){var b=a.find(".fb-connect img"),c=b.attr("src"),d=c.replace("fb-connect.png","fb-connected.png");b.attr("src",d),a.find("p.fb").addClass("connected"),a.find(".fb-connect").bind("click",function(){$.publish(wedding.module.social.Facebook.LOGOUT)}).attr("title","Click to Logout"),$.publish(wedding.module.social.Facebook.GET_ME)},onLogout:function(){var b=a.find(".fb-connect img"),c=b.attr("src"),d=c.replace("fb-connected.png","fb-connect.png");b.attr("src",d),a.find("p.fb").removeClass("connected"),a.find(".fb-connect").bind("click",function(){$.publish(wedding.module.social.Facebook.LOGIN)}).attr("title","Click to Login")},simulateImageMask:function(){b.find("img").imagesLoaded(function(a,b,c){$canvas=b.filter(".us").maskImage(b.filter(".mask"),b.filter(".shadow")),$canvas.cloneCanvas().appendTo($("#rsvp aside"))})}})}.call(wedding);var wedding=wedding||{};wedding.page=wedding.page||{},wedding.page.Story=function(){var a=$("#story"),b=a.find(".gallery"),c=a.find(".stat.gallery"),d=c.find(".count"),e=c.find(".total"),f=c.find(".photo"),g=c.find(".arrow"),h=f.find("img"),i=parseInt(e.text(),10),j=0;return wedding.Page.extend({vars:{},init:function(){Modernizr.cssreflections||f.find("img").reflectImage(80),this.configPhotoGallery()},configPhotoGallery:function(){e.text(),g.bind("click",$.proxy(this.getNextPhoto,this))},getNextPhoto:function(a){var b=$(a.currentTarget);j+=b.hasClass("next")?1:-1,j=j<i?j<0?i-1:j:0,d.text(j+1),h.attr("src",h.data("src")+(j+1)+".jpg"),setTimeout(function(){Modernizr.cssreflections||(f.find("canvas").remove(),h.imagesLoaded(function(a,b,c){console.log(a,b),b.reflectImage(80)}))},100)}})}.call(wedding);var wedding=wedding||{};wedding.page=wedding.page||{},wedding.page.Guests=function(){var a=$("#guests"),b=a.find(".hotel"),c=$(".registries li");return wedding.Page.extend({vars:{},init:function(){c.find("img").reflectImage(40),b.find("img").reflectImage(40)}})}.call(wedding);var wedding=wedding||{};wedding.page=wedding.page||{},wedding.page.RSVP=function(){var a=$("#welcome"),b=$("#rsvp"),c=b.find("form"),d=c.find(".radio"),e=c.find("span.submit"),f=c.find('[name="code"], [name="name"], [name="message"]'),g=c.find(':input[name="attending"]');return wedding.Page.extend({vars:{submitting:!1},init:function(){d.bind("click",$.proxy(this.radioToggle,this)),e.bind("click",function(){c.submit()}),c.bind("submit",$.proxy(this.onSubmit,this)),$.subscribe(wedding.module.social.Facebook.HANDLE_ME,$.proxy(this.autoFillForm,this))},autoFillForm:function(a,b){f.filter('[name="name"]').val(b.name)},toggleSubmit:function(a){a?e.text(e.data("ready")).removeClass("busy").attr("data-copy",e.data("ready")):e.text(e.data("busy")).addClass("busy").attr("data-copy",e.data("busy"))},onSubmit:function(a){var b=!0,d=c.serialize(),e=c.attr("action");return this.toggleSubmit(!1),$.publish("track",[{type:"event",category:"rsvp",action:"submit",label:"attempt"}]),c.find(".error").removeClass("show"),this.vars.submitting&&(b=!1),f.each(function(){$(this).val()||($(this).siblings(".error").addClass("show"),b=!1)}),b?this.vars.xhr=$.ajax({url:e,type:"POST",data:d,dataType:"json",success:$.proxy(this.onSuccess,this),error:function(a){$.publish("track",[{type:"event",category:"rsvp",action:"error",label:"xhr error: "+a}])}}):this.toggleSubmit(!0),!1},onSuccess:function(a){var b=0;this.toggleSubmit(!0);switch(a.result){case 1:$.publish("track",[{type:"event",category:"rsvp",action:"success",label:a.result}]),this.toggleSubmit(!1),e.text("Thanks!").attr("data-copy","Thanks!"),alert("Thanks! We got your RSVP!");var d=$('input[name="attending"]:checked').val();$.publish(wedding.module.social.Facebook.SET_ACTION,{custom_action:"rsvp",properties:{event:"https://shum-harden.com/?type=shwedding:event&attending="+d,scrape:!0}});break;case-1:b=f.filter('[name="code"]').siblings(".error").addClass("show").offset().top,$.publish("track",[{type:"event",category:"rsvp",action:"error",label:"code error"}]);break;case-2:b=c.find("li.submit .error").addClass("show"),offset().top,$.publish("track",[{type:"event",category:"rsvp",action:"error",label:"500 server error"}]);break;case-3:break;default:}b&&$("html,body").animate({scrollTop:b-100},400,"easeInOutQuad")},radioToggle:function(a){var b=$(a.currentTarget),c=b.data("radio"),e=d.filter('[data-radio="'+c+'"]');b.toggleClass("on"),e.not(b).toggleClass("on",!b.hasClass("on")),e.filter(".on").siblings("input").attr("checked","checked")}})}.call(wedding);var wedding=wedding||{};wedding.module=wedding.module||{},wedding.module.social=wedding.module.social||{},function(){wedding.module.social.Facebook=function(){var a={LOGIN:"social/facebook/login",LOGOUT:"social/facebook/logout",GET_STATUS:"social/facebook/get-status",GET_ME:"social/facebook/get-me",SET_ACTION:"social/facebook/set-action",HANDLE_ACTION:"social/facebook/handle-action",HANDLE_ME:"social/facebook/handle-me",HANDLE_LOGIN:"social/facebook/handle-login",HANDLE_LOGOUT:"social/facebook/handle-logout"},b=!1,c=$('[property="og:namespace"]').attr("content");return wedding.module.social.Facebook.extend({init:function(a){this.sup.call(this,a)},customFacebookPost:function(a,b){var c=$(a.currentTarget),d=b||c.data(),e=this.getPublishObj(d),f={message:b.attachmentCaption,link:b.attachmentMediaHref,source:b.attachmentMediaSrc};return this.ifLoggedInRun($.proxy(function(){FB.api("/me/feed","post",f,function(a){a&&!a.error&&$.publish("track",[{type:"event",category:"facebook",action:"on-post",label:d.origin}])})},this)),d},onFBInit:function(){this.sup.call(this),$.subscribe(a.LOGIN,$.proxy(this.getLogin,this)),$.subscribe(a.LOGOUT,$.proxy(this.getLogout,this)),$.subscribe(a.GET_STATUS,$.proxy(this.getStatus,this)),$.subscribe(a.GET_ME,$.proxy(this.getMe,this)),$.subscribe(a.SET_ACTION,$.proxy(this.setAction,this)),this.getStatus()},setAction:function(d,e){if(b){var f=e.action||c+":"+e.custom_action;f&&e.properties?FB.api("/me/"+f,"post",e.properties,function(b){$.publish(a.HANDLE_ACTION,[b])}):console.log("Facebook: You're doing actions wrong")}},ifLoggedInRun:function(a){FB.getLoginStatus(function(b){b.status==="connected"&&a()})},getStatus:function(){FB.getLoginStatus(function(c){c.session||c.status==="connected"?(b=!0,$.publish(a.HANDLE_LOGIN,[c])):(b=!1,$.publish(a.HANDLE_LOGOUT,[c]))})},getLogout:function(){FB.logout(function(c){b=!1,$.publish(a.HANDLE_LOGOUT,[c]),$.publish("track",[{type:"event",category:"facebook",action:"logout",label:"user logged out"}])})},getMe:function(){b&&FB.api("/me",function(b){$.publish(a.HANDLE_ME,[b]),$.publish("track",[{type:"event",category:"facebook",action:"me",label:"got user info"}])})},getLogin:function(){FB.login(function(c){c.authResponse?(b=!0,$.publish(a.HANDLE_LOGIN,[c]),$.publish("track",[{type:"event",category:"facebook",action:"accepted-login",label:"user connected w/ fb"}])):$.publish("track",[{type:"event",category:"facebook",action:"canceled-login",label:"user canceled login"}])},{scope:"publish_actions"})},destroy:function(){this.sup.call(this)}},a)}.call(wedding)}();